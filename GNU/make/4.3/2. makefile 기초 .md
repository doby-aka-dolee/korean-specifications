# 2. makefile 기초 - _An Introduction to Makefiles_

*make*를 실행시켰을 때 *make*는 *makefile*에 적힌대로 작업을 실행해나갑니다.
때문에 커맨드라인에서 *make*를 타이핑하고 엔터를 눌러 실행시키기 전에 *makefile*이라는 파일을 먼저 작성해놓아야 합니다.
일반적으로는 여기에 프로그램의 컴파일이나 링크에 관련된 내용들이 들어갑니다.

이번 장에서는 8개의 C 소스코드 파일들과 3개의 헤더파일로 텍스트편집기 프로그램을 컴파일/링크하는 예제 *makefile*을 작성해 볼 것입니다.
또 컴파일/링크 작업 뿐만 아니라 (명시적인 호출이 있을 경우) 그 외 다양한 작업들이 실행되도록 *makefile*을 기술할 수도 있는데, 대표적으로 오브젝트 파일같은 필요없는 파일들을 삭제하는 작업 등이 있습니다.
예제 *makefile*을 작성하면서 이러한 작업을 기술하는 방법도 다루어보도록 하겠습니다.
이에 대해 보다 자세한 정보를 원하시면 [Complex Makefile](https://www.gnu.org/software/make/manual/make.html#Complex-Makefile)를 살펴보시기 바랍니다.

*make*가 텍스트편집기 프로그램을 재컴파일하는 경우 수정사항이 있는 C 소스코드 파일들은 모두 재컴파일되어야 합니다.
헤더파일이 수정되었다면 그 헤더파일을 인클루드하는 모든 C 소스코드 파일들도 재컴파일 되어야겠죠.
각각의 컴파일 작업은 소스코드 파일 하나당 오브젝트 파일 하나를 생성할 것입니다.
그리고 소스코드 파일이 하나라도 재컴파일되었다면, 즉 오브젝트 파일이 하나라도 재생성되었다면 모든 오브젝트 파일들이 링크되어 새로운 실행파일(텍스트편집기 프로그램)을 만들어내게 됩니다.
이 때 링크되는 오브젝트 파일들은 재생성되었는지의 여부를 따지지 않습니다.
새로 재생성된 오브젝트 파일이든 이전 컴파일 과정에서 생성되었던 오브젝트 파일이든 상관 없이 모든 오브젝트 파일들이 모여 링크됩니다.

## 2.1 규칙(Rule)의 구조 - What a Rule Looks Like
일반적으로 *makefile*은 아래와 같은 구조의 규칙(Rule)들로 이루어져 있습니다.
```
target … : prerequisites …
        recipe
        …
        …
```
*타겟(target)* 은 보통 해당 규칙의 실행으로 인해 만들어지는 파일의 이름입니다. 대표적으로 실행파일이나 오브젝트 파일의 이름이 타겟이 됩니다.
또 어떤 경우는 단순히 실행되어야 할 작업이나 명령의 이름이 타겟이 될 수도 있습니다. '*clean*' 같은 작업이 대표적인 예입니다 ([Phony Targets](https://www.gnu.org/software/make/manual/make.html#Phony-Targets) 참고).

*전제조건(prerequisite)* 은 타겟을 생성 할 때 그 재료로 사용되는 파일입니다. 보통 하나의 타겟 당 여러개의 전제조건들을 가집니다.
전제조건과 관련하여 '의존하다(depend)' 라는 표현도 쓰이는데 '타겟이 전제조건에 의존한다' 와 같이 쓰입니다.
때문에 전제조건을 의존성(dependency)이라고 부르는 경우도 있습니다.

*레시피(recipe)* 는 *make*가 실제로 실행시키는 작업 혹은 명령어들입니다.
이 명령어들은 줄 하나에 쭉 나열되듯이 작성하여도 되고 여러 줄에 나누어서 줄 하나 당 하나의 명령어를 쓰듯이 작성하여도 되니다.
다만 각각의 줄 앞에는 무조건 탭 문자가 와야 합니다. 많이들 빼먹고 실수하는 부분이 꼭 기억해두세요.
혹여 탭 문자가 아닌 다른 문자를 레시피의 접두어로 쓰고 싶다면 *RECIPEPREFIX* 변수를 다른 문자로 설정하면 됩니다.
자세한 내용은 [Special Variables](https://www.gnu.org/software/make/manual/make.html#Special-Variables)을 참고해주세요.

